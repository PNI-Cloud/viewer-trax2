(this.webpackJsonpstudio=this.webpackJsonpstudio||[]).push([[0],{116:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.endpoints=t.NstrumentaClient=t.makeBusMessageFromJsonObject=t.deserializeWireMessage=t.deserializeBlob=t.BusMessage=void 0;var r=n(41);Object.defineProperty(t,"BusMessage",{enumerable:!0,get:function(){return r.BusMessage}}),Object.defineProperty(t,"deserializeBlob",{enumerable:!0,get:function(){return r.deserializeBlob}}),Object.defineProperty(t,"deserializeWireMessage",{enumerable:!0,get:function(){return r.deserializeWireMessage}}),Object.defineProperty(t,"makeBusMessageFromJsonObject",{enumerable:!0,get:function(){return r.makeBusMessageFromJsonObject}});var s=n(54);Object.defineProperty(t,"NstrumentaClient",{enumerable:!0,get:function(){return s.NstrumentaClient}});var i=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).LOCAL?"http://localhost:8080/":"https://us-central1-macro-coil-194519.cloudfunctions.net/";t.endpoints={GET_MACHINES:"".concat(i,"/getMachines"),GET_SIGNED_UPLOAD_URL:"".concat(i,"/getSignedUploadUrl"),GET_TOKEN:"".concat(i,"/getToken"),VERIFY_TOKEN:"".concat(i,"/verifyToken")}},117:function(e,t,n){},124:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),i=n(25),a=n.n(i),o=(n(83),n(13)),c=n(12),u=n(161),l=n(160),f=n(159),d=n(67),b=(n(117),n(34)),h=n(35),p=function(){function e(t){Object(b.a)(this,e),this.maxLength=void 0,this.buffer=void 0,this.partial=void 0,this.maxLength=t,this.buffer=[],this.partial=new Uint8Array}return Object(h.a)(e,[{key:"validate",value:function(e){if(e[1]===e.length)return!0}},{key:"add",value:function(e){var t=this.validate(e)?e:void 0;if(!t){var n=new Uint8Array([].concat(Object(o.a)(this.partial),Object(o.a)(e)));this.validate(n)&&(t=n)}if(t)for(this.buffer.push(t);this.buffer.length>this.maxLength;)this.buffer.shift();else this.partial=e}}]),e}(),g=n(2);var v=function(){var e,t=Object(r.useState)(),n=Object(c.a)(t,2),s=n[0],i=n[1],a=Object(r.useState)(),b=Object(c.a)(a,2),h=b[0],v=b[1],O=Object(r.useState)(),m=Object(c.a)(O,2),B=m[0],j=m[1],E=Object(r.useRef)(),S=Object(r.useReducer)((function(e){return e+1}),0),_=Object(c.a)(S,2),y=(_[0],_[1]),w=Object(r.useRef)(),M=function(e){for(var t=0,n=0,r=e.length-1;r>=0;r--)n=n>>8|n<<8,n^=e[t++],n^=(255&n)>>4,n^=n<<8<<4,n^=(255&n)<<4<<1;return Uint8Array.from([].concat(Object(o.a)(e),[(65280&n)>>8,255&n]))};function k(e){return Object(o.a)(e).map((function(e){return e.toString(16).padStart(2,"0")})).join(" ")}return Object(r.useEffect)((function(){var e=new URLSearchParams(window.location.search).get("wsUrl"),t=e||"ws://localhost:8088",n=new d.NstrumentaClient({apiKey:"f4c560a4-6558-4090-b827-9070c6c4fb3d",wsUrl:t});w.current=n,E.current=new p(100),console.log("connecting to ",t),n.addListener("open",(function(){console.log("nst client open"),n.subscribe("serialport-events",(function(e){if(console.log("serialport-events",e),"open"===e.type)i("open")})),n.subscribe("trax2",(function(e){var t;"open"!==s&&i("open"),null===(t=E.current)||void 0===t||t.add(new Uint8Array(e.data)),y(),console.log("trax2",e);var n=e.data[2];switch(n){case 2:var r=(new TextDecoder).decode(new Uint8Array(e.data.slice(3,-2)));console.log(JSON.stringify(e),r),v(r);break;case 5:console.log("data");break;default:console.log("unhandled frame ID: ".concat(n),e)}}))})),n.init()}),[]),Object(g.jsxs)("div",{className:"App",children:[Object(g.jsxs)(u.a,{container:!0,spacing:2,children:[Object(g.jsxs)(u.a,{item:!0,xs:12,children:[Object(g.jsx)(l.a,{variant:"contained",onClick:function(){if(w.current){var e=M([0,5,1]);console.log("sending kGetModInfo",e),w.current.sendBuffer("trax-in",e)}},children:"kGetModInfo"}),h]}),Object(g.jsx)(u.a,{item:!0,xs:4,children:Object(g.jsx)(f.a,{id:"outlined-basic",label:"[0x00,0x05,0x01]",variant:"outlined",onChange:function(e){console.log(e.target.value);try{var t=e.target.value.replace("[","").replace("]","").split(",").map((function(e){return Number(e)})),n=M(t);console.log(n),j(n)}catch(r){}}})}),Object(g.jsx)(u.a,{item:!0,xs:3,children:B?k(B):null}),Object(g.jsx)(u.a,{item:!0,xs:1,children:Object(g.jsx)(l.a,{variant:"contained",onClick:function(){var e;B&&(e=B,w.current&&w.current.sendBuffer("trax-in",e))},children:"Send"})})]}),Object(g.jsx)("div",{style:{width:"100%",whiteSpace:"pre-line"},children:null===(e=E.current)||void 0===e?void 0:e.buffer.reverse().map((function(e){return k(e)})).join("\n")})]})};a.a.render(Object(g.jsx)(s.a.StrictMode,{children:Object(g.jsx)(v,{})}),document.getElementById("root"))},41:function(e,t,n){"use strict";var r=n(51),s=n(52),i=n(53),a=n(85),o=n(87),c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeByteBuffer=t.deserializeWireMessage=t.deserializeBlob=t.makeBusMessageFromBuffer=t.makeBusMessageFromJsonObject=t.BusMessageType=t.BusMessage=void 0;var u,l=c(n(93)),f=function(e){a(n,e);var t=o(n);function n(){return i(this,n),t.apply(this,arguments)}return n}(l.default);t.BusMessage=f,function(e){e[e.BUS_MESSAGE_TYPES_BEGIN=100]="BUS_MESSAGE_TYPES_BEGIN",e[e.Json=101]="Json",e[e.Buffer=102]="Buffer",e[e.BUS_MESSAGE_TYPES_END=103]="BUS_MESSAGE_TYPES_END"}(u=t.BusMessageType||(t.BusMessageType={}));t.makeBusMessageFromJsonObject=function(e,t){return(new l.default).writeUint32(u.Json).writeIString(e).writeIString(JSON.stringify(t))};t.makeBusMessageFromBuffer=function(e,t){return(new l.default).writeUint32(u.Buffer).writeIString(e).append(t).flip().toBuffer()};var d=function(){var e=s(r.mark((function e(n){var s,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.arrayBuffer();case 2:return s=e.sent,i=new l.default(s.byteLength),new Uint8Array(s).forEach((function(e){i.writeUint8(e)})),i.flip(),e.abrupt("return",(0,t.deserializeByteBuffer)(i));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.deserializeBlob=d;t.deserializeWireMessage=function(e){if(e instanceof ArrayBuffer){var n=new l.default(e.byteLength);return new Uint8Array(e).forEach((function(e){n.writeUint8(e)})),n.flip(),(0,t.deserializeByteBuffer)(n)}var r=new l.default(e.byteLength);return r.buffer=e,(0,t.deserializeByteBuffer)(r)};t.deserializeByteBuffer=function(e){var t=e.readInt32();if(t<=u.BUS_MESSAGE_TYPES_BEGIN||t>=u.BUS_MESSAGE_TYPES_END)throw"unknown busMessageType ".concat(t,": ").concat(e);var n=e.readIString(),r=void 0;switch(t){case u.Json:r=JSON.parse(e.readIString());break;case u.Buffer:r=e.buffer.slice(e.offset)}return{channel:n,busMessageType:t,contents:r}}},54:function(e,t,n){"use strict";var r=n(51),s=n(52),i=n(53),a=n(95),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NstrumentaClient=void 0;var c=o(n(96)),u=n(116),l=n(41),f=function(){function e(t){var n=t.apiKey,r=t.wsUrl;i(this,e),this.host=new URL("ws://localhost:".concat(8088)),this.ws=null,this.apiKey=n,this.listeners=new Map,this.subscriptions=new Map,this.host=new URL(r||this.host),this.subscribe=this.subscribe.bind(this),this.init=this.init.bind(this)}return a(e,[{key:"init",value:function(){var e=s(r.mark((function e(t){var n,i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={"x-api-key":this.apiKey,"Content-Type":"application/json"},c.default.get(u.endpoints.GET_TOKEN,{headers:n}).then((function(e){console.log("getToken",e)})),this.ws=t?new t(this.host):new WebSocket(this.host),this.ws.addEventListener("open",(function(){var e;console.log("client websocket opened <".concat(i.host,">")),null===(e=i.listeners.get("open"))||void 0===e||e.forEach((function(e){return e()}))})),this.ws.addEventListener("close",(function(){var e;null===(e=i.listeners.get("close"))||void 0===e||e.forEach((function(e){return e()})),console.log("client websocket closed <".concat(i.host,">"))})),this.ws.addEventListener("message",function(){var e=s(r.mark((function e(t){var n,s,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!("undefined"!==typeof Blob&&t.data instanceof Blob)){e.next=7;break}return e.next=4,(0,l.deserializeBlob)(t.data);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=(0,l.deserializeWireMessage)(t.data);case 8:s=e.t0,a=s.channel,o=s.contents,null===(n=i.subscriptions.get(a))||void 0===n||n.forEach((function(e){e(o)})),e.next=17;break;case 14:e.prev=14,e.t1=e.catch(0),console.error("nstrumenta client message error",e.t1);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){var n;console.log("sandbox-client send",e,t),null===(n=this.ws)||void 0===n||n.send((0,l.makeBusMessageFromJsonObject)(e,t).buffer)}},{key:"sendBuffer",value:function(e,t){var n;console.log("sandbox-client sendBuffer",e,t),null===(n=this.ws)||void 0===n||n.send((0,l.makeBusMessageFromBuffer)(e,t))}},{key:"subscribe",value:function(e,t){var n;console.log("Nstrumenta client subscribe <".concat(e,">"));var r=this.subscriptions.get(e)||[];r.push(t),this.subscriptions.set(e,r),null===(n=this.ws)||void 0===n||n.send((0,l.makeBusMessageFromJsonObject)("_command",{command:"subscribe",channel:e}).buffer)}},{key:"addListener",value:function(e,t){this.listeners.get(e)||this.listeners.set(e,[]);var n=this.listeners.get(e);n&&n.push(t)}}]),e}();t.NstrumentaClient=f},67:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.endpoints=t.NstrumentaClient=t.makeBusMessageFromJsonObject=t.deserializeWireMessage=t.deserializeBlob=t.BusMessage=void 0;var r=n(41);Object.defineProperty(t,"BusMessage",{enumerable:!0,get:function(){return r.BusMessage}}),Object.defineProperty(t,"deserializeBlob",{enumerable:!0,get:function(){return r.deserializeBlob}}),Object.defineProperty(t,"deserializeWireMessage",{enumerable:!0,get:function(){return r.deserializeWireMessage}}),Object.defineProperty(t,"makeBusMessageFromJsonObject",{enumerable:!0,get:function(){return r.makeBusMessageFromJsonObject}});var s=n(54);Object.defineProperty(t,"NstrumentaClient",{enumerable:!0,get:function(){return s.NstrumentaClient}});var i=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).LOCAL?"http://localhost:8080/":"https://us-central1-macro-coil-194519.cloudfunctions.net/";t.endpoints={GET_MACHINES:"".concat(i,"/getMachines"),GET_SIGNED_UPLOAD_URL:"".concat(i,"/getSignedUploadUrl"),GET_TOKEN:"".concat(i,"/getToken"),VERIFY_TOKEN:"".concat(i,"/verifyToken")}},83:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.26d09b9a.chunk.js.map